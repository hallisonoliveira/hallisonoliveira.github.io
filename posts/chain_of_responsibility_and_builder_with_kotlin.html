<!DOCTYPE html> <html lang="pt-br"> <head> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Chain Of Responsibility e Builder - Um exemplo prático em Kotlin </title> <!-- CSS --> <link rel="stylesheet" href="/src/css/syntax.css"> <link rel="stylesheet" href="/src/css/lanyon.css"> <!-- Icons --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png"> <link rel="shortcut icon" href="/assets/img/favicon.png"> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <!-- Cards --> <link rel="stylesheet" href="/src/css/main.css"> <link rel="alternate" type="application/rss+xml" title="Hallison Oliveira" href="https://hallisonoliveira.com.br/feed.xml"> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> </head> <body> <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"> <!-- Toggleable sidebar --> <div class="sidebar" id="sidebar"> <div class="sidebar-item"> <h4 style="color: white; text-align: center">Hallison Oliveira</h4> </div> <div style="text-align: center"> <a href="https://www.linkedin.com/in/hallisonoliveira" style="margin-right: 8px"> <img src="/src/images/linkedin.png"/> </a> <a href="https://github.com/hallisonoliveira" style="margin-right: 15px"> <img src="/src/images/github.png"/> </a> <a href="https://twitter.com/hallisoncwb"> <img src="/src/images/twitter.png"/> </a> </div> <br /> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Inicio</a> <a class="sidebar-nav-item" href="/posts">Posts</a> <a class="sidebar-nav-item" href="/about">Sobre</a> </nav> <div class="sidebar-item"> <p> &copy; 2025. Todos os direitos reservados. </p> </div> </div> <div class="wrap"> <div class="masthead"> <div class="container masthead-flex"> <h3 class="masthead-title"> <a href="/" title="Home">Hallison Oliveira</a> <small></small> </h3> <div class="language-switcher"> <a href="/en/posts/chain_of_responsibility_and_builder_with_kotlin.html" class="lang-btn "> <img src="/assets/img/flags/us.svg" alt="English" class="flag-icon"> </a> </div> </div> </div> <div class="container"> <div class="wrapper"> <div class="row"> <div class="col-md-10"> <article class="page-post" itemscope itemtype="http://schema.org/BlogPosting"> <!-- Título do Post --> <h1 class="post-title" itemprop="name headline">Chain Of Responsibility e Builder - Um exemplo prático em Kotlin</h1> <!-- Categoria e Data --> <div class="post-meta"> <span class="post-category">Design Patterns</span> <span class="post-date"> <time datetime="2024-01-29T00:00:00-03:00" itemprop="datePublished">Jan 29, 2024</time> </span> </div> <!-- Imagem --> <div class="post-image"> <img src="/images/chain_of_responsibility_and_builder.png" alt="Chain Of Responsibility e Builder - Um exemplo prático em Kotlin" class="post-image-img"> </div> <!-- Conteúdo do Post --> <div class="post-content" itemprop="articleBody"> <h1 id="os-design-patterns">Os Design Patterns</h1> <h2 id="chain-of-responsibility">Chain Of Responsibility</h2> <p>O <strong><em>Chain of Responsibility</em></strong> (Cadeia de Responsabilidade) é um padrão de projeto que permite organizar objetos em uma sequência hierárquica, onde cada objeto na cadeia tem a capacidade de processar uma solicitação ou passá-la para o próximo nível da hierarquia. Esse padrão é útil quando múltiplos objetos podem lidar com uma solicitação, mas não se sabe antecipadamente qual deles será responsável por processá-la.</p> <p>Para facilitar o entendimento, podemos ver esse padrão como uma corrente, onde cada elo dessa corrente possui uma referência para o próximo elo e um método para processar a solicitação. Essa solicitação percorre cada elo da corrente até que seja processada por um deles ou chegue ao final da cadeia sem ser tratada. Isso proporciona flexibilidade e desacopla o remetente da solicitação do seu destinatário, tornando o sistema mais modular e fácil de manter.</p> <p>No exemplo apresentado aqui, cada elo tem uma função que indicará se ele deverá ser executado e uma função com a lógica a ser aplicada. Se o elo deve ser executado, a função com a lógica é chamada. Se o elo não puder ser executado, a execução da corrente continua e o próximo elo será acionado. Há também uma classe responsável por manter a instância de cada elo da corrente e por chamar todos os elos. Se um dos elos for executado, a classe da corrente interrompe a execução e retorna o resultado para quem à chamou.</p> <p>Esse padrão é muito interessante e é frequentemente utilizado em situações em que há múltiplos manipuladores para um mesmo tipo de solicitação, como em sistemas de processamento de eventos, validações e/ou cálculos para diferentes tipos de dados ou em casos em que o comportamento do sistema pode ser estendido sem a necessidade de modificar o código existente, sendo um recurso muito útil já que precisamos ter sempre em mente os princípios <a href="/posts/solid.html">SOLID</a>.</p> <h2 id="builder">Builder</h2> <p>O padrão <strong><em>Builder</em></strong> é um padrão de projeto voltado para a construção de objetos complexos. Ele é útil quando a construção de determinado objeto exige uma grande quantidade de informações ou envolve uma série de lógicas com diversas etapas. Assim, nesses casos, é possível abstrair toda a complexidade da criação do objeto para uma classe separada, responsável apenas pelo processo de criação.</p> <p>No exemplo apresentado aqui, utilizamos esse padrão para a construção da classe que gerencia a cadeia de regras. Através do <strong><em>Builder</em></strong>, adicionamos as regras à cadeia, com possibilidade de adicionar uma regra padrão, e ao final, recebemos a instância da classe da cadeia.</p> <h1 id="vamos-ao-código">Vamos ao código</h1> <p>Para exemplificar o uso dos padrões <strong><em>Chain Of Responsibility</em></strong> e <strong><em>Builder</em></strong>, trago um sistema simples de cálculo de preço de venda de veículos.</p> <p>Como entrada para esse sistema, fornecemos um determinado veículo com um tipo (carro ou pickup), um fabricante (Chevrolet ou Ford) e um preço de tabela. As regras de cálculo serão aplicadas ao preço de tabela e resultarão num preço final de venda, a ser definido via regras de cálculo.</p> <p>Para a representação do veículo, temos o <em>data class</em> <code class="language-plaintext highlighter-rouge">Vehicle</code>, com o atributo <code class="language-plaintext highlighter-rouge">type</code> (<em>Enum</em>), que indica se o veículo é um carro (<code class="language-plaintext highlighter-rouge">CAR</code>), uma pickup (<code class="language-plaintext highlighter-rouge">PICKUP</code>) ou um ônibus (<code class="language-plaintext highlighter-rouge">BUS</code>) e o atributo <code class="language-plaintext highlighter-rouge">brand</code> indicando o fabricante, conforme a seguir:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Vehicle</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">brand</span><span class="p">:</span> <span class="nc">Brand</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">type</span><span class="p">:</span> <span class="nc">Type</span>
<span class="p">)</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Type</span> <span class="p">{</span>
    <span class="nc">CAR</span><span class="p">,</span>
    <span class="nc">PICKUP</span><span class="p">,</span>
    <span class="nc">BUS</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Brand</span> <span class="p">{</span>
    <span class="nc">CHEVROLET</span><span class="p">,</span>
    <span class="nc">FORD</span>
<span class="p">}</span>
</code></pre></div></div> <p>Cada combinação de tipo de veículo e fabricante terá uma regra específica para o cálculo de preço de venda. Usaremos o padrão <strong><em>Chain Of Responsibility</em></strong> para gerenciar a aplicação dessas regras. Assim, para cada par tipo + fabricante, teremos uma implementação da classe de regra.</p> <p>As classes de regra devem seguir o formato definido pela classe abstrata <code class="language-plaintext highlighter-rouge">SellValueCalculationRule</code>, que pode ser vista abaixo:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">abstract</span> <span class="kd">class</span> <span class="nc">SellValueCalculationRule</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">):</span> <span class="nc">Boolean</span>

    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">):</span> <span class="nc">Double</span>

    <span class="k">fun</span> <span class="nf">run</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nf">shouldCalculate</span><span class="p">(</span><span class="n">vehicle</span><span class="p">))</span> <span class="p">{</span>
        <span class="nf">doCalculation</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">null</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Essa classe possui três funções:</p> <ul> <li><code class="language-plaintext highlighter-rouge">shouldCalculate</code> - Essa função recebe um objeto <code class="language-plaintext highlighter-rouge">Vehicle</code> como parâmetro e retorna um <em>Boolean</em>. É nela onde colocamos a lógica que define se a regra deve ser executada ou não. Se a regra deve ser executada, essa função deve retornar <code class="language-plaintext highlighter-rouge">true</code>, se não, ela deve retornar <code class="language-plaintext highlighter-rouge">false</code>. Perceba que ela está marcada como <code class="language-plaintext highlighter-rouge">protected</code>, o que indica que ela não pode ser acessada externamente.</li> <li><code class="language-plaintext highlighter-rouge">doCalculation</code> - Essa função recebe um objeto <code class="language-plaintext highlighter-rouge">Vehicle</code> como parâmetro e retorna um <em>Double</em>. É nela onde colocamos a implementação da lógica de cálculo da regra. Ou seja, é nessa função onde o cálculo do preço de venda será feito. Perceba que, assim como a função <code class="language-plaintext highlighter-rouge">shouldCalculate</code>, essa função também está marcada como <code class="language-plaintext highlighter-rouge">protected</code>.</li> <li><code class="language-plaintext highlighter-rouge">run</code> - Essa função recebe um objeto <code class="language-plaintext highlighter-rouge">Vehicle</code> como parâmetro e retorna um <em>Double nullable</em>. Essa é a única função que poderá ser acessada externamente e que não terá sua implementação feita pelas classes de regras. Ela faz parte da estrutura da cadeia e é responsável por chamar a função <code class="language-plaintext highlighter-rouge">shouldExecute</code> para verificar se a regra deve ser executada. Se sim, a função <code class="language-plaintext highlighter-rouge">doCalculation</code> é chamada e seu resultado é retornado. Se a função <code class="language-plaintext highlighter-rouge">shouldExecute</code> retornar <code class="language-plaintext highlighter-rouge">false</code> indicando que a regra não deve ser executada, a função <code class="language-plaintext highlighter-rouge">run</code> retornará <code class="language-plaintext highlighter-rouge">null</code>, indicando para a classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> que a próxima regra deve ser chamada.</li> </ul> <p>A seguir, temos as implementações concretas das regras de cálculo de preço de venda para cada combinação de tipo e fabricante de veículo.</p> <p>Para veículos do tipo <code class="language-plaintext highlighter-rouge">CAR</code> e fabricante <code class="language-plaintext highlighter-rouge">CHEVROLET</code>:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ChevroletCarSellValueCalculationRule</span> <span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">CAR</span> <span class="p">&amp;&amp;</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">brand</span> <span class="p">==</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">CHEVROLET</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span><span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">+</span> <span class="p">((</span><span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">*</span> <span class="nc">CHEVROLET_CAR_INTEREST_VALUE</span><span class="p">)</span> <span class="p">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">CHEVROLET_CAR_INTEREST_VALUE</span> <span class="p">=</span> <span class="mf">0.99</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Para veículos do tipo <code class="language-plaintext highlighter-rouge">PICKUP</code> e fabricante <code class="language-plaintext highlighter-rouge">CHEVROLET</code>:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ChevroletPickupSellValueCalculationRule</span> <span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">PICKUP</span> <span class="p">&amp;&amp;</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">brand</span> <span class="p">==</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">CHEVROLET</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span><span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">+</span>
                <span class="p">((</span><span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">*</span> <span class="nc">CHEVROLET_PICKUP_INTEREST_PERCENTAGE_VALUE</span><span class="p">)</span> <span class="p">/</span> <span class="mi">100</span><span class="p">)</span> <span class="p">-</span>
                <span class="nc">CHEVROLET_PICKUP_DISCOUNT_MONETARY_VALUE</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">CHEVROLET_PICKUP_INTEREST_PERCENTAGE_VALUE</span> <span class="p">=</span> <span class="mf">0.49</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">CHEVROLET_PICKUP_DISCOUNT_MONETARY_VALUE</span> <span class="p">=</span> <span class="mf">1500.00</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Para veículos do tipo <code class="language-plaintext highlighter-rouge">CAR</code> e fabricante <code class="language-plaintext highlighter-rouge">FORD</code>:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FordCarSellValueCalculationRule</span> <span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">CAR</span> <span class="p">&amp;&amp;</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">brand</span> <span class="p">==</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">FORD</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">+</span> <span class="p">((</span><span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">*</span> <span class="nc">CHEVROLET_CAR_INTEREST_VALUE</span><span class="p">)</span> <span class="p">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">CHEVROLET_CAR_INTEREST_VALUE</span> <span class="p">=</span> <span class="mf">0.49</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Para veículos do tipo <code class="language-plaintext highlighter-rouge">PICKUP</code> e fabricante <code class="language-plaintext highlighter-rouge">FORD</code>:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FordPickupSellValueCalculationRule</span> <span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">PICKUP</span> <span class="p">&amp;&amp;</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">brand</span> <span class="p">==</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">FORD</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">+</span>
            <span class="p">((</span><span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">*</span> <span class="nc">FORD_PICKUP_INTEREST_PERCENTAGE_VALUE</span><span class="p">)</span> <span class="p">/</span> <span class="mi">100</span><span class="p">)</span> <span class="p">-</span>
            <span class="nc">FORD_PICKUP_DISCOUNT_MONETARY_VALUE</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">FORD_PICKUP_INTEREST_PERCENTAGE_VALUE</span> <span class="p">=</span> <span class="mf">0.69</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">FORD_PICKUP_DISCOUNT_MONETARY_VALUE</span> <span class="p">=</span> <span class="mf">2000.00</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Por fim, vamos criar uma regra <em>default</em> para demonstrar seu funcionamento:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">DefaultDiscountCalculationRule</span> <span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">shouldCalculate</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">=</span> <span class="k">true</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">doCalculation</span><span class="p">(</span>
        <span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">-</span> <span class="p">((</span><span class="n">vehicle</span><span class="p">.</span><span class="n">value</span> <span class="p">*</span> <span class="nc">GENERAL_DISCOUNT_PERCENTAGE_VALUE</span><span class="p">)</span> <span class="p">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">GENERAL_DISCOUNT_PERCENTAGE_VALUE</span> <span class="p">=</span> <span class="mf">0.1</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Perceba que na função <code class="language-plaintext highlighter-rouge">shouldCalculate</code> de cada regra, é verificado o tipo do veículo e o fabricante, criando a pré condição para que a regra seja executada. Já na classe da regra <em>default</em>, essa função retorna <code class="language-plaintext highlighter-rouge">true</code> diretamente. Assim, garantimos que ela sempre vai executar. Devemos apenas garantir que essa regra seja sempre utilizada apenas como regra <em>default</em>. Se ela for adicionada com as demais regras, a execução da cadeia terá um comportamento inválido, já que ao passar por essa regra, ela sempre será executada, fazendo com que as demais regras - definidas após ela - sejam ignoradas.</p> <p>Para todas as regras, temos o cálculo em si definidos na função <code class="language-plaintext highlighter-rouge">doCalculation</code>.</p> <p>Por fim, podemos ver que a função <code class="language-plaintext highlighter-rouge">run</code> não está presente em nenhuma implementação concreta de regra.</p> <p>Com as regras implementadas, podemos passar para a classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code>, responsável por gerenciar a cadeia de regras. Ela é a representação da corrente de regras e é dentro dela que as regras - os elos da corrente - serão armazenados.</p> <p>Sua implementação pode ser vista a seguir:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SellValueCalculationChain</span> <span class="k">private</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">calculationRules</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">SellValueCalculationRule</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">defaultCalculationRule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="k">fun</span> <span class="nf">addRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">calculationRules</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">setDefaultRule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">defaultCalculationRule</span> <span class="p">=</span> <span class="n">rule</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">run</span><span class="p">(</span><span class="n">vehicle</span><span class="p">:</span> <span class="nc">Vehicle</span><span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>

        <span class="n">calculationRules</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">calculationRule</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">calculationResult</span> <span class="p">=</span> <span class="n">calculationRule</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>
            <span class="n">calculationResult</span><span class="o">?.</span><span class="nf">run</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">defaultCalculationRule</span><span class="o">?.</span><span class="nf">run</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">defaultCalculationResult</span> <span class="p">=</span> <span class="nf">run</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>
            <span class="n">defaultCalculationResult</span><span class="o">?.</span><span class="nf">run</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">vehicle</span><span class="p">.</span><span class="n">value</span>
    <span class="p">}</span>

    <span class="kd">object</span> <span class="nc">Builder</span> <span class="p">{</span>

        <span class="k">private</span> <span class="kd">val</span> <span class="py">rules</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">SellValueCalculationRule</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>
        <span class="k">private</span> <span class="kd">var</span> <span class="py">defaultRule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

        <span class="k">fun</span> <span class="nf">add</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">)</span> <span class="p">=</span> <span class="nf">apply</span> <span class="p">{</span>
            <span class="n">rules</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">fun</span> <span class="nf">setDefault</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="nc">SellValueCalculationRule</span><span class="p">)</span> <span class="p">=</span> <span class="nf">apply</span> <span class="p">{</span>
            <span class="n">defaultRule</span> <span class="p">=</span> <span class="n">rule</span>
        <span class="p">}</span>

        <span class="k">fun</span> <span class="nf">build</span><span class="p">():</span> <span class="nc">SellValueCalculationChain</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">chain</span> <span class="p">=</span> <span class="nc">SellValueCalculationChain</span><span class="p">()</span>
            <span class="n">rules</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="n">chain</span><span class="o">::</span><span class="n">addRule</span><span class="p">)</span>
            <span class="n">defaultRule</span><span class="o">?.</span><span class="nf">run</span><span class="p">(</span><span class="n">chain</span><span class="o">::</span><span class="n">setDefaultRule</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">chain</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Nessa classe temos diversos pontos interessantes a serem vistos:</p> <p>Construtor privado para garantirmos que essa classe não será instanciada sem o uso do <em>Builder</em> (explicado a seguir).</p> <p>Lista <code class="language-plaintext highlighter-rouge">calculationRules</code> que representa as regras pertencentes à cadeia, ou seja, os elos da corrente.</p> <p>Função <code class="language-plaintext highlighter-rouge">addRule</code> que será utilizada para adicionar as regras à cadeia, uma por uma. Ao chamar a essa função, a regra passada por parâmetro será adicionada ao fim lista <code class="language-plaintext highlighter-rouge">calculationRules</code>.</p> <p>Objeto <code class="language-plaintext highlighter-rouge">defaultCalculationRule</code> que representa a regra <em>default</em> da cadeia. Se nenhuma regra presente na lista <code class="language-plaintext highlighter-rouge">calculationRules</code> for executada, a regra <em>default</em> será executada, se estiver definida (≠ null).</p> <p>Função <code class="language-plaintext highlighter-rouge">setDefaultRule</code> responsável por definir a regra <em>default</em> da cadeia. Ao chamar essa função, a regra passada por parâmetro será definida como valor do objeto <code class="language-plaintext highlighter-rouge">defaultCalculationRule</code>. Como podemos ter apenas uma regra <em>default</em>, se a função for chamada mais de uma vez, o valor do objeto será substituído.</p> <p>Função <code class="language-plaintext highlighter-rouge">run</code>. Essa função recebe um objeto <code class="language-plaintext highlighter-rouge">Vehicle</code> e retorna um <em>Double</em> e é responsável por chamar todas as regras presentes na lista <code class="language-plaintext highlighter-rouge">calculationRules</code>, uma após a outra, na sequência em que foram adicionadas.</p> <ul> <li>Se alguma regra for executada (retornar um valor válido diferente de <code class="language-plaintext highlighter-rouge">null</code>), esse valor sera retornado pela função <code class="language-plaintext highlighter-rouge">run</code> imediatamente;</li> <li>Se nenhuma regra for executada, a regra <em>default</em> será chamada e seu resultado será retornado, se ela estiver definida;</li> <li>Se nenhuma regra da lista <code class="language-plaintext highlighter-rouge">calculationRules</code> for executada e não houver uma regra <em>default</em> definida, então apenas retornamos o valor de tabela do veículo recebido como parâmetro.</li> </ul> <p>Dentro da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code>, temos a classe <em>Builder</em>. Como o nome sugere, essa classe é a implementação do <em>design pattern Builder</em> e é ela a responsável por construir a classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code>. Nela também temos uma lista de regras (<code class="language-plaintext highlighter-rouge">rules</code>) e um objeto que representa a regra <em>default (<code class="language-plaintext highlighter-rouge">defaultRule</code>)</em>.</p> <p>A lista <code class="language-plaintext highlighter-rouge">rules</code> é uma lista temporária que serve apenas para armazenar as regras durante o processo de criação da instância da classe da cadeia.</p> <p>Assim como a lista <code class="language-plaintext highlighter-rouge">rules</code>, o objeto <code class="language-plaintext highlighter-rouge">defaultRule</code> também é temporário e serve apenas para armazenada a regra <em>default</em> - se usada - durante o processo de criação da classe da cadeia.</p> <p>Temos as funções <code class="language-plaintext highlighter-rouge">add</code> para adicionar as regras e <code class="language-plaintext highlighter-rouge">setDefault</code> para definir a regra <em>default</em>.</p> <p>A função principal aqui é a função <code class="language-plaintext highlighter-rouge">build</code>. Ela não recebe parâmetro algum e retorna uma instância da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code>. É nela onde está toda a lógica para a criação da classe da cadeia. Quando chamada, ela cria uma instância da classe, adiciona todas as regras presentes na lista <code class="language-plaintext highlighter-rouge">rules</code> do <em>Builder</em> à instância da classe da cadeia, uma por uma e, em seguida, a função define a regra <em>default</em>, se ela estiver definida. Por fim, a função retorna a instância recém criada da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> com todas as regras adicionadas.</p> <p>Abaixo, temos uma função <code class="language-plaintext highlighter-rouge">main()</code> para demonstrar o sistema de cálculo de preço de venda em funcionamento:</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Sistema de cálculo de preço de venda"</span><span class="p">)</span>

    <span class="cm">/** Criação dos veículos para serem utilizados nos cálculos **/</span>
    <span class="kd">val</span> <span class="py">chevroletCamaro</span> <span class="p">=</span> <span class="nc">Vehicle</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">CAR</span><span class="p">,</span>
        <span class="n">brand</span> <span class="p">=</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">CHEVROLET</span><span class="p">,</span>
        <span class="n">value</span> <span class="p">=</span> <span class="mf">150000.00</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">chevroletSilverado</span> <span class="p">=</span> <span class="nc">Vehicle</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">PICKUP</span><span class="p">,</span>
        <span class="n">brand</span> <span class="p">=</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">CHEVROLET</span><span class="p">,</span>
        <span class="n">value</span> <span class="p">=</span> <span class="mf">190000.00</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">fordMaverick</span> <span class="p">=</span> <span class="nc">Vehicle</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">CAR</span><span class="p">,</span>
        <span class="n">brand</span> <span class="p">=</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">FORD</span><span class="p">,</span>
        <span class="n">value</span> <span class="p">=</span> <span class="mf">155000.00</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">fordRanger</span> <span class="p">=</span> <span class="nc">Vehicle</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">PICKUP</span><span class="p">,</span>
        <span class="n">brand</span> <span class="p">=</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">FORD</span><span class="p">,</span>
        <span class="n">value</span> <span class="p">=</span> <span class="mf">185000.00</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">fordBus</span> <span class="p">=</span> <span class="nc">Vehicle</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nc">Type</span><span class="p">.</span><span class="nc">BUS</span><span class="p">,</span>
        <span class="n">brand</span> <span class="p">=</span> <span class="nc">Brand</span><span class="p">.</span><span class="nc">FORD</span><span class="p">,</span>
        <span class="n">value</span> <span class="p">=</span> <span class="mf">200000.00</span>
    <span class="p">)</span>

    <span class="cm">/** Criação da cadeia de regras de cálculos **/</span>
    <span class="kd">val</span> <span class="py">sellCalculationChain</span> <span class="p">=</span> <span class="nc">SellValueCalculationChain</span><span class="p">.</span><span class="nc">Builder</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">ChevroletCarSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">ChevroletPickupSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">FordCarSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">FordPickupSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">setDefault</span><span class="p">(</span><span class="nc">DefaultDiscountCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>

    <span class="cm">/** Calculo de venda do Chevrolet Camaro **/</span>
    <span class="kd">val</span> <span class="py">chevroletCamaroSellValue</span> <span class="p">=</span> <span class="n">sellCalculationChain</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">chevroletCamaro</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Chevrolet Camaro\n\t- Preço de tabela: ${chevroletCamaro.value}\n\t- Preço de venda: ${chevroletCamaroSellValue}\n"</span><span class="p">)</span>
    <span class="cm">/**
     * Chevrolet Camaro
     * 	- Preço de tabela: 150000.0
     * 	- Preço de venda: 151485.0
     */</span>

    <span class="cm">/** Calculo de venda do Chevrolet Silverado **/</span>
    <span class="kd">val</span> <span class="py">chevroletSilveradoSellValue</span> <span class="p">=</span> <span class="n">sellCalculationChain</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">chevroletSilverado</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Chevrolet Silverado\n\t- Preço de tabela: ${chevroletSilverado.value}\n\t- Preço de venda: ${chevroletSilveradoSellValue}\n"</span><span class="p">)</span>
    <span class="cm">/**
     * Chevrolet Silverado
     * 	- Preço de tabela: 190000.0
     * 	- Preço de venda: 189431.0
     */</span>

    <span class="cm">/** Calculo de venda do Ford Maverick **/</span>
    <span class="kd">val</span> <span class="py">fordMaverickSellValue</span> <span class="p">=</span> <span class="n">sellCalculationChain</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">fordMaverick</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Ford Maverick\n\t- Preço de tabela: ${fordMaverick.value}\n\t- Preço de venda: ${fordMaverickSellValue}\n"</span><span class="p">)</span>
    <span class="cm">/**
     * Ford Maverick
     * 	- Preço de tabela: 155000.0
     * 	- Preço de venda: 155759.5
     */</span>

    <span class="cm">/** Calculo de venda do Ford Ranger **/</span>
    <span class="kd">val</span> <span class="py">fordRangerSellValue</span> <span class="p">=</span> <span class="n">sellCalculationChain</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">fordRanger</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Ford Ranger\n\t- Preço de tabela: ${fordRanger.value}\n\t- Preço de venda: ${fordRangerSellValue}\n"</span><span class="p">)</span>
    <span class="cm">/**
     * Ford Ranger
     * 	- Preço de tabela: 185000.0
     * 	- Preço de venda: 184276.5
     */</span>

    <span class="cm">/** Calculo de venda do onibus Ford **/</span>
    <span class="kd">val</span> <span class="py">fordBusSellValue</span> <span class="p">=</span> <span class="n">sellCalculationChain</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">fordBus</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Onibus Ford\n\t- Preço de tabela: ${fordBus.value}\n\t- Preço de venda: ${fordBusSellValue}\n"</span><span class="p">)</span>
    <span class="cm">/**
     * Onibus Ford
     * 	- Preço de tabela: 200000.0
     * 	- Preço de venda: 199800.0
     */</span>
<span class="p">}</span>
</code></pre></div></div> <p>Para demonstrar o funcionamento do sistema, primeiro criamos os objetos que representam os veículos, através do <em>data class</em> <code class="language-plaintext highlighter-rouge">Vehicle</code>.</p> <p>Em seguida, criamos a instância da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> através do <em>Builder</em>, adicionando as classes de regras. Perceba que, para cada regra, chamamos a função <code class="language-plaintext highlighter-rouge">add</code>. Temos também a definição da regra <em>default</em> através da função <code class="language-plaintext highlighter-rouge">setDefault</code>.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">sellCalculationChain</span> <span class="p">=</span> <span class="nc">SellValueCalculationChain</span><span class="p">.</span><span class="nc">Builder</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">ChevroletCarSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">ChevroletPickupSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">FordCarSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">FordPickupSellValueCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">setDefault</span><span class="p">(</span><span class="nc">DefaultDiscountCalculationRule</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">(</span>
</code></pre></div></div> <p>Com a instância da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> criada, podemos executar os cálculos de preço de venda para os veículos criados anteriormente. Para isso, basta chamar a função <code class="language-plaintext highlighter-rouge">run</code> passando veículo como parâmetro. O resultado será o preço de venda do veículo. Para informação, podemos comparar o preço de tabela com o preço de venda através dos comentários adicionados abaixo de cada chamada.</p> <p>O último veículo que teve seu preço de venda calculado é o objeto <code class="language-plaintext highlighter-rouge">fordBus</code>. Esse veículo é do tipo <code class="language-plaintext highlighter-rouge">BUS</code> e do fabricante <code class="language-plaintext highlighter-rouge">FORD</code>. Para essa combinação de tipo + fabricante, nós não criamos nenhuma classe de regra. Assim, o cálculo do preço de venda para esse veículo foi feito através da regra <em>default</em>. Se essa regra não estivesse definida, teríamos como retorno o preço de tabela do veículo.</p> <p>Perceba que, em nenhum momento, nós vinculamos os veículos às regras de cálculo e nem informamos diretamente qual regra deve ser executada para determinado veículo. Ou seja, quem chama a função <code class="language-plaintext highlighter-rouge">run</code> da classe da cadeia de regras, não tem conhecimento sobre qual regra será executada, nem como essas regras foram implementadas. Assim, a função <code class="language-plaintext highlighter-rouge">main</code> não possui a responsabilidade de saber como efetuar o cálculo do preço de venda dos veículos, ela só precisa saber que precisa chamar a função <code class="language-plaintext highlighter-rouge">run</code> passando o veículo a ser calculado como parâmetro e esperar o resultado do tipo <em>Double</em>.</p> <h1 id="algumas-considerações-pessoais">Algumas considerações pessoais</h1> <p>Gostaria de citar aqui alguns pontos que eu considero importantes quanto à implementação desses padrões de projeto.</p> <h2 id="chain-of-responsibility-1">Chain Of Responsibility</h2> <ul> <li>A premissa principal desse padrão é a possibilidade de adicionar novos elos à cadeia sem que seja necessário alterar os elos já existentes ou alterar a estrutura da cadeia. Tendo isso em mente, conseguimos respeitar o <a href="/posts/open_close_principle.html">Princípio Aberto/Fechado</a> do <a href="/posts/solid.html">SOLID</a>;</li> <li>Sobre a implementação das classes dos elos da cadeia, é fundamental que o contrato definido para os elos (classe abstrata) seja bem desenhado, pois ele deve conseguir atender à todos os cenários que a cadeia vai ter. Porém, devemos sempre nos preocupar em não tentar torna-la “completa demais” e criar funções e variáveis além do realmente necessário. Não podemos esquecer do <a href="/posts/interface_segregation.html">Princípio da Segregação de Interface</a>, o “I” do do <a href="/posts/solid.html">SOLID</a>;</li> <li>Quanto aos elos da cadeia, é fundamental que toda a lógica referente àquele elo esteja dentro da classe de implementação do elo ou em classes auxiliares. Um elo da cadeia não pode depender de outro em termos de lógica;</li> <li>Ao implementar esse padrão de projeto, a estrutura não pode permitir que os dados que trafegam entre os elos da cadeia sejam alterados. Ou seja, os dados não podem ser alterados em um elo e repassados para outro elo. A partir do momento que um elo da cadeia é executado, a execução da cadeia deve ser interrompida;</li> <li>A responsabilidade da função <code class="language-plaintext highlighter-rouge">shouldCalculate</code> dos elos é única e exclusivamente decidir se o elo deve ser executado ou não. Dentro dessa função, devemos ter o mínimo de lógica possível para tomar essa decisão;</li> <li>Não podemos esquecer dos testes unitários. Como temos classes pequenas e de escopo muito bem definido para os elos da cadeia, é possível testá-las tranquilamente;</li> <li>No projeto apresentado aqui, utilizei a classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> como responsável pelo controle da chamada dos elos. Na definição desse padrão, essa classe não existe. Ao invés disso, cada elo é responsável por conhecer o próximo elo e chamá-lo quando necessário. Eu, pessoalmente, prefiro ter uma classe que faça esse controle. Assim, os elos deixam de ter a responsabilidade de conhecer e chamar o próximo elo, ficando apenas com a responsabilidade de “decidir” quando eles devem ser executados e com a lógica em si. Essa classe em conjunto com o uso do padrão <em>Builder</em> torna a criação da cadeia mais simples e a adição ou remoção de elos fica facilitada, inclusive em tempo de execução quando precisamos “ligar” ou ‘desligar” algum elo com base em <em>feature flags</em> (ou <em>feature toggles</em>).</li> </ul> <h2 id="builder-1">Builder</h2> <ul> <li>Esse padrão é muito útil quando precisamos criar objetos complexos e que dependem de várias informações externas, que não poderiam ser feitas apenas passando dados via construtor;</li> <li>É importante que a classe a ser construída através do <em>Builder</em> tenha seu construtor marcado como privado. Isso evita que a classe seja construída sem o uso do seu <em>Builder</em>, ajudando a eliminar possíveis inconsistências de dados ou comportamentos inadequados ao criar a instância da classe de forma errada/não recomendada.</li> <li>No exemplo apresentado aqui, eu defini a classe <em>Builder</em> como <a href="https://kotlinlang.org/docs/object-declarations.html#object-declarations-overview"><code class="language-plaintext highlighter-rouge">object</code></a>, uma forma de criar <em>Singleton</em> em Kotlin. Como esse exemplo é simples, não precisamos de nenhuma classe auxiliar para que a instância da classe <code class="language-plaintext highlighter-rouge">SellValueCalculationChain</code> seja criada, então o <em>Builder</em> ser um <em>Singleton</em> faz total sentido. Se alguma classe fosse necessária, poderíamos definir o <em>Builder</em> como uma classe comum e passar a classe auxiliar como parâmetro de construtor do <em>Builder</em>. <ul> <li>Acredito que seja importante que as funções públicas do <em>Builder</em> sejam apenas voltadas para a criação da instância da classe da qual aquele <em>Builder</em> pertence. Se eventualmente o <em>Builder</em> precisar de alguma classe extra para que ele possa criar a instância, essa classe deve ser passada no construtor do <em>Builder,</em> nunca via função. Assim, evitamos confusões quanto ao uso do <em>Builder</em>. Em resumo, usamos o construtor do <em>Builder</em> para fornecer dados necessários para o <em>Builder</em> fazer o seu trabalho e as funções públicas são para fornecer dados ao <em>Builder</em> que serão adicionadas à instância da classe a ser criada.</li> </ul> </li> </ul> <h1 id="projeto-completo">Projeto completo</h1> <p>Para ver esse projeto no <a href="https://github.com/hallisonoliveira/ChainOfResponsibilityAndBuilderWithKotlin">Github</a> ou no <a href="https://pl.kotl.in/-Tp4Dfgp4">Kotlin Playground</a></p> <h1 id="referências">Referências</h1> <ul> <li><a href="https://refactoring.guru/design-patterns/chain-of-responsibility">Refactoring Guru - Chain of Responsibility</a></li> <li><a href="https://refactoring.guru/design-patterns/builder">Refactoring Guru - Builder</a></li> </ul> </div> <div class="row"> <ul> </ul> </div> </article> <!-- Seção de Comentários (Disqus) --> <div class="row"> <br/> Comente abaixo e dê seu feedback em relação ao post. <br/> <div id="disqus_thread"></div> <script> var disqus_config = function () { this.page.url = 'https://hallisonoliveira.com.br/posts/chain_of_responsibility_and_builder_with_kotlin.html'; this.page.identifier = '/posts/chain_of_responsibility_and_builder_with_kotlin.html'; }; (function () { var d = document, s = d.createElement('script'); s.src = 'https://hallisonoliveira.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> </div> </div> </div> </div> </div> </div> <label for="sidebar-checkbox" class="sidebar-toggle"></label> <script> (function(document) { var toggle = document.querySelector('.sidebar-toggle'); var sidebar = document.querySelector('#sidebar'); var checkbox = document.querySelector('#sidebar-checkbox'); document.addEventListener('click', function(e) { var target = e.target; if(!checkbox.checked || sidebar.contains(target) || (target === checkbox || target === toggle)) return; checkbox.checked = false; }, false); })(document); </script> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script> <script src="/src/js/bootstrap.min.js"></script> </body> </html>
